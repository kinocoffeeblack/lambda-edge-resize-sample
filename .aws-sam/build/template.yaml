AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31
Globals:
  Function:
    Runtime: nodejs10.x
    Handler: index.handler
Resources:
  EdgeLambdaMyBasicRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: EdgeLambdaMyBasicRole
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          Effect: Allow
          Principal:
            Service:
            - lambda.amazonaws.com
            - edgelambda.amazonaws.com
          Action:
          - sts:AssumeRole
      Path: /service-role/
      ManagedPolicyArns:
      - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      - arn:aws:iam::aws:policy/AmazonS3FullAccess
  ViewerRequest:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: ImgResizerViewerRequest
      Description: covert querystring to path
      CodeUri: ViewerRequest
      AutoPublishAlias: prod
      MemorySize: 128
      Timeout: 1
      Role:
        Fn::GetAtt:
        - EdgeLambdaMyBasicRole
        - Arn
  OriginResponse:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: ImgResizerOriginResponse
      Description: create resized image if not exists
      CodeUri: OriginResponse
      AutoPublishAlias: prod
      MemorySize: 512
      Timeout: 5
      Role:
        Fn::GetAtt:
        - EdgeLambdaMyBasicRole
        - Arn
